
<%- include('../partials/nav.ejs') %>
<h1 class="mb-5" style="text-align: center">Add Product</h1>
<div class="container">
   <hr> 
</div>

<!--Dropdown Menu-->
<div class="dropdown">
    <button class="btn btn-outline-secondary dropdown-toggle" type="button" id="productsDropdown" data-bs-toggle="dropdown" aria-expanded="false">
        Select Product To Edit
    </button>
    <ul class="dropdown-menu dropdown-menu-dark">
        <% products.forEach((product) => {%>
            <li>
                <form method="get">
                    <button type="submit" formaction="/addProducts/edit" value="<%= product.id %>" name="id">
                        <%= product.name %>
                    </button>
                </form>
            </li>
        <% }) %>
    </ul>
</div>

<div class="container" style="max-width: 500px;">
    <button class="btn btn-outline-secondary mb-3" id="upload_widget">Upload Image</button>
    <form method="post" action="addProduct\submit">
        <input id="ImageURL" type="hidden" name="picLocation">
        <input type="hidden" name="_csrf" value="<%=csrfToken%>">
        <input class="form-control mb-3" type="text" name="name" maxlength="25" placeholder="Product Title" required>
        <input class="form-control mb-3" type="text" name="description"  maxLength="60" placeholder="Product Description" required>
        <div class="input-group mb-3">
            <span class="input-group-text">$</span>
            <input class="form-control" type="text" name="price" aria-label="Price (to the nearest dollar)">
            <span class="input-group-text">.00</span> 
        </div>
        <button type="submit" class="btn btn-outline-secondary mb-3">Submit Item</button>
    </form>
    <img id="thumbnail" src="/images/NoImage.png" style="max-width: 500px;">
    <script src="https://upload-widget.cloudinary.com/global/all.js" type="text/javascript"></script>  
</div>




<script type="text/javascript">  
    var myWidget = cloudinary.createUploadWidget({
      cloudName: 'drig2qdcm', 
      uploadPreset: 'v3yvbipy'}, (error, result) => { 
        if (!error && result && result.event === "success") { 
          //console.log('Done! Here is the image info: ', result.info); 
          document.getElementById("ImageURL").value = result.info.secure_url
          document.getElementById("thumbnail").src = result.info.secure_url
        }
      }
    )
    
    document.getElementById("upload_widget").addEventListener("click", function(){
        myWidget.open();
      }, false);
    </script>